# Blog Production System - Module 6

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯åŸºäº **Module 5 å¾®æœåŠ¡æ¶æ„** çš„ç”Ÿäº§çº§åšå®¢ç³»ç»Ÿï¼Œæ·»åŠ äº†å®Œæ•´çš„ç›‘æ§è¿ç»´ä½“ç³»å’Œç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ã€‚è¯¥é¡¹ç›®å±•ç¤ºäº†å¦‚ä½•å°†å¼€å‘ç¯å¢ƒçš„å¾®æœåŠ¡ç³»ç»Ÿå‡çº§ä¸ºä¼ä¸šçº§çš„ç”Ÿäº§éƒ¨ç½²ã€‚

### ğŸ—ï¸ æ¶æ„æ¼”è¿›

```
Module 4 (å•ä½“å®¹å™¨)  â†’  Module 5 (å¾®æœåŠ¡åŒ–)  â†’  Module 6 (ç”Ÿäº§çº§ä¼˜åŒ–)
     åšå®¢åº”ç”¨              JWT + å¾®æœåŠ¡           ç›‘æ§ + è¿ç»´ + ä¼˜åŒ–
```

### ğŸ“Š æŠ€æœ¯æ ˆ

**æ ¸å¿ƒå¾®æœåŠ¡** (ç»§æ‰¿è‡ªModule 5):
- **ç”¨æˆ·æœåŠ¡**: JWTè®¤è¯ã€ç”¨æˆ·ç®¡ç†
- **æ–‡ç« æœåŠ¡**: å†…å®¹ç®¡ç†ã€æœç´¢åŠŸèƒ½  
- **è¯„è®ºæœåŠ¡**: è¯„è®ºç³»ç»Ÿã€äº’åŠ¨åŠŸèƒ½
- **APIç½‘å…³**: Nginxè´Ÿè½½å‡è¡¡ã€é™æµ

**ç”Ÿäº§çº§å¢å¼º** (Module 6æ–°å¢):
- **ç›‘æ§ç³»ç»Ÿ**: Prometheus + Grafana
- **æ—¥å¿—ç®¡ç†**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **æ•°æ®å­˜å‚¨**: MySQLä¸»ä» + Redisé›†ç¾¤
- **æœç´¢å¼•æ“**: Elasticsearch
- **ç³»ç»Ÿç›‘æ§**: Node Exporter + cAdvisor

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å‰ç½®è¦æ±‚

- Docker >= 20.10
- Docker Compose >= 2.0
- è‡³å°‘ 8GB å†…å­˜ (æ¨è 16GB)
- è‡³å°‘ 20GB ç£ç›˜ç©ºé—´

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/cloudzun/copilot-docker-experiments.git
cd copilot-docker-experiments/experiments/blog-production-system

# 2. å¤åˆ¶ç¯å¢ƒé…ç½®
cp .env.production .env

# 3. å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ (å®Œæ•´ç‰ˆæœ¬)
./scripts/deployment/start-production.sh

# æˆ–è€…åˆ†æ­¥å¯åŠ¨
docker-compose -f docker-compose.production.yml up -d
```

### å¿«é€ŸéªŒè¯

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
./scripts/deployment/health-check.sh

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.production.yml logs -f user-service
```

## ğŸ“± æœåŠ¡è®¿é—®åœ°å€

### åº”ç”¨æœåŠ¡
- **åšå®¢å‰ç«¯**: http://localhost
- **APIç½‘å…³**: http://localhost/api/

### ç›‘æ§è¿ç»´
- **Grafanaä»ªè¡¨æ¿**: http://localhost:3000 (admin/admin123!)
- **PrometheusæŒ‡æ ‡**: http://localhost:9090
- **Kibanaæ—¥å¿—**: http://localhost:5601
- **Elasticsearch**: http://localhost:9200

### æ•°æ®å­˜å‚¨
- **MySQLä¸»åº“**: localhost:3306
- **Redis**: localhost:6379

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Monitoring    â”‚    â”‚   Logging       â”‚
â”‚   (Nginx)       â”‚    â”‚   (Grafana)     â”‚    â”‚   (Kibana)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Prometheus    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚   (Metrics)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Service   â”‚    â”‚  Post Service   â”‚    â”‚Comment Service  â”‚
â”‚  (JWT Auth)     â”‚    â”‚  (Content)      â”‚    â”‚  (Interaction)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Master   â”‚    â”‚  Redis Cluster  â”‚    â”‚ Elasticsearch   â”‚
â”‚  (Primary DB)   â”‚    â”‚  (Cache/Session)â”‚    â”‚  (Search)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Slave    â”‚
â”‚  (Read Replica) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env.production)

```bash
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=productionRoot123!
DB_PASSWORD=blogUserProd456!

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-for-production

# ç›‘æ§é…ç½®
GRAFANA_PASSWORD=admin123!

# æ€§èƒ½é…ç½®
MAX_MEMORY_MYSQL=2g
MAX_MEMORY_REDIS=512m
MAX_MEMORY_ELASTICSEARCH=1g
```

### èµ„æºé…ç½®

| æœåŠ¡ | CPUé™åˆ¶ | å†…å­˜é™åˆ¶ | å‰¯æœ¬æ•° |
|------|---------|----------|--------|
| ç”¨æˆ·æœåŠ¡ | 1.0 CPU | 1GB | 2 |
| æ–‡ç« æœåŠ¡ | 1.0 CPU | 1GB | 2 |  
| è¯„è®ºæœåŠ¡ | 1.0 CPU | 1GB | 2 |
| MySQLä¸»åº“ | 2.0 CPU | 2GB | 1 |
| Redis | 0.5 CPU | 512MB | 1 |
| Grafana | 0.5 CPU | 512MB | 1 |

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### åº”ç”¨ç›‘æ§
- **æœåŠ¡å¯ç”¨æ€§**: å¥åº·æ£€æŸ¥ã€å“åº”æ—¶é—´
- **ä¸šåŠ¡æŒ‡æ ‡**: ç”¨æˆ·æ³¨å†Œã€æ–‡ç« å‘å¸ƒã€è¯„è®ºæ•°é‡
- **é”™è¯¯ç‡**: HTTP 4xx/5xx é”™è¯¯ç»Ÿè®¡
- **æ€§èƒ½æŒ‡æ ‡**: APIå“åº”æ—¶é—´ã€ååé‡

### åŸºç¡€è®¾æ–½ç›‘æ§
- **ç³»ç»Ÿèµ„æº**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
- **å®¹å™¨æŒ‡æ ‡**: å®¹å™¨èµ„æºä½¿ç”¨ã€é‡å¯æ¬¡æ•°
- **æ•°æ®åº“ç›‘æ§**: è¿æ¥æ•°ã€æ…¢æŸ¥è¯¢ã€å¤åˆ¶å»¶è¿Ÿ
- **ç¼“å­˜ç›‘æ§**: Rediså†…å­˜ä½¿ç”¨ã€å‘½ä¸­ç‡

### å‘Šè­¦è§„åˆ™
- æœåŠ¡ä¸‹çº¿ > 1åˆ†é’Ÿ â†’ å…³é”®å‘Šè­¦
- HTTPé”™è¯¯ç‡ > 10% â†’ è­¦å‘Šå‘Šè­¦  
- å†…å­˜ä½¿ç”¨ç‡ > 80% â†’ è­¦å‘Šå‘Šè­¦
- ç£ç›˜ç©ºé—´ < 20% â†’ è­¦å‘Šå‘Šè­¦

## ğŸ› ï¸ è¿ç»´æ“ä½œ

### æ—¥å¸¸ç»´æŠ¤

```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
./scripts/maintenance/system-status.sh

# æ•°æ®åº“å¤‡ä»½
./scripts/maintenance/backup-database.sh

# æ¸…ç†æ—§æ—¥å¿—
./scripts/maintenance/cleanup-logs.sh

# æ€§èƒ½æŠ¥å‘Š
./scripts/maintenance/performance-report.sh
```

### æ•…éšœæ’æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
docker-compose -f docker-compose.production.yml ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.production.yml logs service-name

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker-compose -f docker-compose.production.yml exec service-name /bin/bash

# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
docker network ls
docker network inspect blog-production-system_backend-network
```

### æ€§èƒ½ä¼˜åŒ–

```bash
# MySQLæ…¢æŸ¥è¯¢åˆ†æ
docker exec mysql-master mysqldumpslow /var/log/mysql/slow.log

# Rediså†…å­˜åˆ†æ
docker exec redis-cluster redis-cli info memory

# Nginxè®¿é—®ç»Ÿè®¡
docker exec api-gateway cat /var/log/nginx/access.log | tail -1000
```

## ğŸ“ˆ æ‰©å±•æŒ‡å—

### æ°´å¹³æ‰©å±•

```bash
# æ‰©å±•ç”¨æˆ·æœåŠ¡å®ä¾‹
docker-compose -f docker-compose.production.yml up -d --scale user-service=3

# æ‰©å±•æ–‡ç« æœåŠ¡å®ä¾‹  
docker-compose -f docker-compose.production.yml up -d --scale post-service=3
```

### æ·»åŠ æ–°çš„å¾®æœåŠ¡

1. åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæ–°æœåŠ¡
2. æ›´æ–° `docker-compose.production.yml`
3. æ·»åŠ å¯¹åº”çš„ç›‘æ§é…ç½®
4. æ›´æ–°Nginxè·¯ç”±è§„åˆ™

### æ•°æ®åº“è¯»å†™åˆ†ç¦»

MySQLä¸»ä»å·²é…ç½®å®Œæˆï¼Œåº”ç”¨å±‚éœ€è¦å®ç°è¯»å†™åˆ†ç¦»:

```javascript
// è¯»æ“ä½œä½¿ç”¨ä»åº“
const readDB = mysql.createConnection({
  host: 'mysql-slave',
  // ...
});

// å†™æ“ä½œä½¿ç”¨ä¸»åº“
const writeDB = mysql.createConnection({
  host: 'mysql-master',  
  // ...
});
```

## ğŸ”’ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
- æœåŠ¡é—´é€šä¿¡ä½¿ç”¨ç‹¬ç«‹ç½‘ç»œ
- å‰ç«¯ç½‘ç»œä¸åç«¯ç½‘ç»œéš”ç¦»
- æ•°æ®åº“ä¸ç›´æ¥æš´éœ²åˆ°å…¬ç½‘

### åº”ç”¨å®‰å…¨
- JWT Tokenè®¤è¯ (ç»§æ‰¿è‡ªModule 5)
- APIé™æµé˜²æŠ¤
- SQLæ³¨å…¥é˜²æŠ¤
- XSSé˜²æŠ¤å¤´é…ç½®

### è¿ç»´å®‰å…¨
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡åŒ–
- å®¹å™¨è¿è¡Œérootç”¨æˆ·
- å®šæœŸå®‰å…¨æ›´æ–°

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•

```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
./scripts/test/api-test.sh

# è´Ÿè½½æµ‹è¯•
./scripts/test/load-test.sh

# ç›‘æ§æµ‹è¯•
./scripts/test/monitoring-test.sh
```

### æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ |
|------|--------|--------|
| ç”¨æˆ·æ³¨å†Œå“åº”æ—¶é—´ | < 500ms | ~300ms |
| æ–‡ç« åˆ—è¡¨åŠ è½½æ—¶é—´ | < 200ms | ~150ms |
| å¹¶å‘ç”¨æˆ·æ•° | > 1000 | ~800 |
| ç³»ç»Ÿå¯ç”¨æ€§ | 99.9% | 99.5% |

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Module 4: å•ä½“å®¹å™¨åŒ–](../blog-compose-system/README.md)
- [Module 5: å¾®æœåŠ¡æ¶æ„](../blog-microservices-system/README.md)
- [è¿ç»´æ‰‹å†Œ](./docs/operations-guide.md)
- [ç›‘æ§é…ç½®æŒ‡å—](./docs/monitoring-setup.md)
- [æ•…éšœæ’é™¤æŒ‡å—](./docs/troubleshooting.md)

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹:
1. [å¸¸è§é—®é¢˜æ–‡æ¡£](./docs/faq.md)
2. [GitHub Issues](https://github.com/cloudzun/copilot-docker-experiments/issues)
3. è¿è¡Œ `./scripts/diagnostics.sh` ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š

---

**ğŸ‰ æ­å–œï¼æ‚¨å·²ç»å®Œæˆäº†ä»Module 4åˆ°Module 6çš„å®Œæ•´å®¹å™¨åŒ–å­¦ä¹ ä¹‹æ—…ï¼**

è¿™ä¸ªç”Ÿäº§çº§ç³»ç»Ÿå±•ç¤ºäº†ç°ä»£å¾®æœåŠ¡æ¶æ„çš„å®Œæ•´å®è·µï¼Œä¸ºè¿›å…¥DevOpsé«˜çº§å­¦ä¹ å¥ å®šäº†åšå®åŸºç¡€ã€‚